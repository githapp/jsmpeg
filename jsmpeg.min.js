var JSMpeg={Player:null,VideoElement:null,BitBuffer:null,Source:{},Demuxer:{},Decoder:{},Renderer:{},AudioOutput:{},Now:function(){return window.performance?window.performance.now()/1e3:Date.now()/1e3},CreateVideoElements:function(){for(var a=document.querySelectorAll(".jsmpeg"),b=0;b<a.length;b++)new JSMpeg.VideoElement(a[b])},Fill:function(a,b){if(a.fill)a.fill(b);else for(var c=0;c<a.length;c++)a[c]=b}};"complete"===document.readyState?JSMpeg.CreateVideoElements():document.addEventListener("DOMContentLoaded",JSMpeg.CreateVideoElements);
JSMpeg.VideoElement=function(){"use strict";var a=function(b){var c=b.dataset.url;if(!c)throw"VideoElement has no `data-url` attribute";var d=function(a,b){for(var c in b)a.style[c]=b[c]};this.container=b,d(this.container,{display:"inline-block",position:"relative",minWidth:"80px",minHeight:"80px"}),this.canvas=document.createElement("canvas"),this.canvas.width=960,this.canvas.height=540,d(this.canvas,{display:"block",width:"100%"}),this.container.appendChild(this.canvas),this.playButton=document.createElement("div"),this.playButton.innerHTML=a.PLAY_BUTTON,d(this.playButton,{zIndex:2,position:"absolute",top:"0",bottom:"0",left:"0",right:"0",maxWidth:"75px",maxHeight:"75px",margin:"auto",opacity:"0.7",cursor:"pointer"}),this.container.appendChild(this.playButton);var e={canvas:this.canvas};for(var f in b.dataset)try{e[f]=JSON.parse(b.dataset[f])}catch(g){e[f]=b.dataset[f]}if(this.player=new JSMpeg.Player(c,e),!e.poster||e.autoplay||this.player.options.streaming||(e.decodeFirstFrame=!1,this.poster=new Image,this.poster.src=e.poster,this.poster.addEventListener("load",this.posterLoaded),d(this.poster,{display:"block",zIndex:1,position:"absolute",top:0,left:0,bottom:0,right:0}),this.container.appendChild(this.poster)),this.player.options.streaming||this.container.addEventListener("click",this.onClick.bind(this)),(e.autoplay||this.player.options.streaming)&&(this.playButton.style.display="none"),this.player.audioOut&&!this.player.audioOut.unlocked){var h=this.container;(e.autoplay||this.player.options.streaming)&&(this.unmuteButton=document.createElement("div"),this.unmuteButton.innerHTML=a.UNMUTE_BUTTON,d(this.unmuteButton,{zIndex:2,position:"absolute",bottom:"10px",right:"20px",width:"75px",height:"75px",margin:"auto",opacity:"0.7",cursor:"pointer"}),this.container.appendChild(this.unmuteButton),h=this.unmuteButton),this.unlockAudioBound=this.onUnlockAudio.bind(this,h),h.addEventListener("touchstart",this.unlockAudioBound,!1),h.addEventListener("click",this.unlockAudioBound,!0)}};return a.prototype.onUnlockAudio=function(a,b){this.unmuteButton&&(b.preventDefault(),b.stopPropagation()),this.player.audioOut.unlock(function(){this.unmuteButton&&(this.unmuteButton.style.display="none"),a.removeEventListener("touchstart",this.unlockAudioBound),a.removeEventListener("click",this.unlockAudioBound)}.bind(this))},a.prototype.onClick=function(a){this.player.isPlaying?(this.player.pause(),this.playButton.style.display="block"):(this.player.play(),this.playButton.style.display="none",this.poster&&(this.poster.style.display="none"))},a.PLAY_BUTTON='<svg style="max-width: 75px; max-height: 75px;" viewBox="0 0 200 200" alt="Play video"><circle cx="100" cy="100" r="90" fill="none" stroke-width="15" stroke="#fff"/><polygon points="70, 55 70, 145 145, 100" fill="#fff"/></svg>',a.UNMUTE_BUTTON='<svg style="max-width: 75px; max-height: 75px;" viewBox="0 0 75 75"><polygon class="audio-speaker" stroke="none" fill="#fff" points="39,13 22,28 6,28 6,47 21,47 39,62 39,13"/><g stroke="#fff" stroke-width="5"><path d="M 49,50 69,26"/><path d="M 69,50 49,26"/></g></svg>',a}();
JSMpeg.Player=function(){"use strict";var a=function(a,b){this.options=b||{},this.canPlay=!1,b.source?(this.source=new b.source(a,b),b.streaming=!!this.source.streaming):a.match(/^wss?:\/\//)?(this.source=new JSMpeg.Source.WebSocket(a,b),b.streaming=!0):b.progressive!==!1?(b.chunkLoaded=this.chunkLoaded.bind(this),this.source=new JSMpeg.Source.AjaxProgressive(a,b),b.streaming=!1):(this.source=new JSMpeg.Source.Ajax(a,b),b.streaming=!1),"function"!=typeof this.options.canPlayCallback&&(this.options.canPlayCallback=function(){}),this.maxAudioLag=b.maxAudioLag||.25,this.autoplay=!!b.autoplay||b.streaming,this.demuxer=new JSMpeg.Demuxer.TS(b),this.source.connect(this.demuxer),b.video!==!1&&(this.video=new JSMpeg.Decoder.MPEG1Video(b),this.renderer=!b.disableGl&&JSMpeg.Renderer.WebGL.IsSupported()?new JSMpeg.Renderer.WebGL(b):new JSMpeg.Renderer.Canvas2D(b),this.demuxer.connect(JSMpeg.Demuxer.TS.STREAM.VIDEO_1,this.video),this.video.connect(this.renderer)),b.audio!==!1&&JSMpeg.AudioOutput.WebAudio.IsSupported()&&(this.audio=new JSMpeg.Decoder.MP2Audio(b),this.audioOut=new JSMpeg.AudioOutput.WebAudio(b),this.demuxer.connect(JSMpeg.Demuxer.TS.STREAM.AUDIO_1,this.audio),this.audio.connect(this.audioOut)),Object.defineProperty(this,"currentTime",{get:this.getCurrentTime,set:this.setCurrentTime}),Object.defineProperty(this,"volume",{get:this.getVolume,set:this.setVolume}),this.source.start(),this.autoplay&&this.play()};return a.prototype.chunkLoaded=function(){this.isPlaying||this.canPlay?this.wantsToPlay&&!this.isPlaying&&this.options.canPlayCallback():(this.canPlay=!0,this.options.canPlayCallback())},a.prototype.play=function(a){this.wantsToPlay=!0,this.update()},a.prototype.pause=function(a){this.wantsToPlay=!1,this.isPlaying=!1,this.audio&&this.audio.canPlay&&(this.audioOut.stop(),this.seek(this.currentTime))},a.prototype.getVolume=function(){return this.audioOut?this.audioOut.volume:0},a.prototype.setVolume=function(a){this.audioOut&&(this.audioOut.volume=a)},a.prototype.stop=function(a){this.pause(),this.seek(0),this.video&&this.options.decodeFirstFrame!==!1&&this.video.decode()},a.prototype.destroy=function(){this.pause(),this.source.destroy(),this.renderer.destroy(),this.audioOut.destroy()},a.prototype.seek=function(a){var b=this.audio&&this.audio.canPlay?this.audio.startTime:this.video.startTime;this.video&&this.video.seek(a+b),this.audio&&this.audio.seek(a+b),this.startTime=JSMpeg.Now()-a},a.prototype.getCurrentTime=function(){return this.audio&&this.audio.canPlay?this.audio.currentTime-this.audio.startTime:this.video.currentTime-this.video.startTime},a.prototype.setCurrentTime=function(a){this.seek(a)},a.prototype.update=function(){return this.wantsToPlay&&requestAnimationFrame(this.update.bind(this)),this.source.established?(this.isPlaying||(this.isPlaying=!0,this.startTime=JSMpeg.Now()-this.currentTime),void(this.options.streaming?this.updateForStreaming():this.updateForStaticFile())):void(this.renderer&&this.renderer.renderProgress(this.source.progress))},a.prototype.updateForStreaming=function(){if(this.video&&this.video.decode(),this.audio){var a=!1;do this.audioOut.enqueuedTime>this.maxAudioLag&&(this.audioOut.resetEnqueuedTime(),this.audioOut.enabled=!1),a=this.audio.decode();while(a);this.audioOut.enabled=!0}},a.prototype.updateForStaticFile=function(){var a=!1,b=0;if(this.audio&&this.audio.canPlay){for(;!a&&this.audio.decodedTime-this.audio.currentTime<.25;)a=!this.audio.decode();this.video&&this.video.currentTime<this.audio.currentTime&&(a=!this.video.decode()),b=this.demuxer.currentTime-this.audio.currentTime}else if(this.video){var c=JSMpeg.Now()-this.startTime+this.video.startTime,d=c-this.video.currentTime,e=1/this.video.frameRate;this.video&&d>0&&(d>2*e&&(this.startTime+=d),a=!this.video.decode()),b=this.demuxer.currentTime-c}a&&this.source.completed?(this.pause(),"function"==typeof this.options.endedCallback&&this.options.endedCallback()):this.source.resume(b)},a}();
JSMpeg.BitBuffer=function(){"use strict";var a=function(b,c){"object"==typeof b?(this.bytes=b instanceof Uint8Array?b:new Uint8Array(b),this.byteLength=this.bytes.length):(this.bytes=new Uint8Array(b||1048576),this.byteLength=0),this.mode=c||a.MODE.EXPAND,this.index=0};return a.prototype.resize=function(a){var b=new Uint8Array(a);0!==this.byteLength&&(this.byteLength=Math.min(this.byteLength,a),b.set(this.bytes,0,this.byteLength)),this.bytes=b,this.index=Math.min(this.index,this.byteLength<<3)},a.prototype.evict=function(a){var b=this.index>>3,c=this.bytes.length-this.byteLength;return this.index===this.byteLength<<3||a>c+b?(this.byteLength=0,void(this.index=0)):void(0!==b&&(this.bytes.copyWithin?this.bytes.copyWithin(0,b,this.byteLength):this.bytes.set(this.bytes.subarray(b,this.byteLength)),this.byteLength=this.byteLength-b,this.index-=b<<3))},a.prototype.write=function(b){var c="object"==typeof b[0],d=0,e=this.bytes.length-this.byteLength;if(c)for(var d=0,f=0;f<b.length;f++)d+=b[f].byteLength;else d=b.byteLength;if(d>e)if(this.mode===a.MODE.EXPAND){var g=Math.max(2*this.bytes.length,d-e);this.resize(g)}else this.evict(d);if(c)for(var f=0;f<b.length;f++)this.appendSingleBuffer(b[f]);else this.appendSingleBuffer(b)},a.prototype.appendSingleBuffer=function(a){a=a instanceof Uint8Array?a:new Uint8Array(a),this.bytes.set(a,this.byteLength),this.byteLength+=a.length},a.prototype.findNextStartCode=function(){for(var a=this.index+7>>3;a<this.byteLength;a++)if(0==this.bytes[a]&&0==this.bytes[a+1]&&1==this.bytes[a+2])return this.index=a+4<<3,this.bytes[a+3];return this.index=this.byteLength<<3,-1},a.prototype.findStartCode=function(a){for(var b=0;;)if(b=this.findNextStartCode(),b===a||-1===b)return b;return-1},a.prototype.nextBytesAreStartCode=function(){var a=this.index+7>>3;return a>=this.byteLength||0==this.bytes[a]&&0==this.bytes[a+1]&&1==this.bytes[a+2]},a.prototype.peek=function(a){for(var b=this.index,c=0;a;){var d=this.bytes[b>>3],e=8-(7&b),f=a>e?e:a,g=e-f,h=255>>8-f;c=c<<f|(d&h<<g)>>g,b+=f,a-=f}return c},a.prototype.read=function(a){var b=this.peek(a);return this.index+=a,b},a.prototype.skip=function(a){return this.index+=a},a.prototype.rewind=function(a){this.index=Math.max(this.index-a,0)},a.prototype.has=function(a){return(this.byteLength<<3)-this.index>=a},a.MODE={EVICT:1,EXPAND:2},a}();
JSMpeg.Source.Ajax=function(){"use strict";var a=function(a,b){this.url=a,this.destination=null,this.request=null,this.completed=!1,this.established=!1,this.progress=0};return a.prototype.connect=function(a){this.destination=a},a.prototype.start=function(){this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&200===this.request.status&&this.onLoad(this.request.response)}.bind(this),this.request.onprogress=this.onProgress.bind(this),this.request.open("GET",this.url),this.request.responseType="arraybuffer",this.request.send()},a.prototype.resume=function(a){},a.prototype.destroy=function(){this.request.abort()},a.prototype.onProgress=function(a){this.progress=a.loaded/a.total},a.prototype.onLoad=function(a){this.established=!0,this.completed=!0,this.progress=1,this.destination&&this.destination.write(a)},a}();
JSMpeg.Source.AjaxProgressive=function(){"use strict";var a=function(a,b){this.url=a,this.destination=null,this.request=null,this.completed=!1,this.established=!1,this.progress=0,this.fileSize=0,this.loadedSize=0,this.chunkSize=b.chunkSize||1048576,this.isLoading=!1,this.loadStartTime=0,this.throttled=b.throttled!==!1,this.aborted=!1,this.onChunkLoaded=b.chunkLoaded||function(){}};return a.prototype.connect=function(a){this.destination=a},a.prototype.start=function(){this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&(this.fileSize=parseInt(this.request.getResponseHeader("Content-Length")),this.onChunkLoaded(),this.loadNextChunk())}.bind(this),this.request.onprogress=this.onProgress.bind(this),this.request.open("HEAD",this.url),this.request.send()},a.prototype.resume=function(a){if(!this.isLoading&&this.throttled){var b=8*this.loadTime+2;b>a&&this.loadNextChunk()}},a.prototype.destroy=function(){this.request.abort(),this.aborted=!0},a.prototype.loadNextChunk=function(){var a=this.loadedSize,b=Math.min(this.loadedSize+this.chunkSize-1,this.fileSize-1);return a>=this.fileSize||this.aborted?void(this.completed=!0):(this.isLoading=!0,this.loadStartTime=JSMpeg.Now(),this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&this.request.status>=200&&this.request.status<300?this.onChunkLoad(this.request.response):this.request.readyState===this.request.DONE&&this.loadFails++<3&&this.loadNextChunk()}.bind(this),0===a&&(this.request.onprogress=this.onProgress.bind(this)),this.request.open("GET",this.url+"?"+a+"-"+b),this.request.setRequestHeader("Range","bytes="+a+"-"+b),this.request.responseType="arraybuffer",void this.request.send())},a.prototype.onProgress=function(a){this.progress=a.loaded/a.total},a.prototype.onChunkLoad=function(a){this.onChunkLoaded(),this.established=!0,this.progress=1,this.loadedSize+=a.byteLength,this.loadFails=0,this.isLoading=!1,this.destination&&this.destination.write(a),this.loadTime=JSMpeg.Now()-this.loadStartTime,this.throttled||this.loadNextChunk()},a}();
JSMpeg.Source.WebSocket=function(){"use strict";var a=function(a,b){this.url=a,this.options=b,this.socket=null,this.callbacks={connect:[],data:[]},this.destination=null,this.reconnectInterval=void 0!==b.reconnectInterval?b.reconnectInterval:5,this.shouldAttemptReconnect=!!this.reconnectInterval,this.completed=!1,this.established=!1,this.progress=0,this.reconnectTimeoutId=0};return a.prototype.connect=function(a){this.destination=a},a.prototype.destroy=function(){clearTimeout(this.reconnectTimeoutId),this.shouldAttemptReconnect=!1,this.socket.close()},a.prototype.start=function(){this.shouldAttemptReconnect=!!this.reconnectInterval,this.progress=0,this.established=!1,this.socket=new WebSocket(this.url,this.options.protocols||""),this.socket.binaryType="arraybuffer",this.socket.onmessage=this.onMessage.bind(this),this.socket.onopen=this.onOpen.bind(this),this.socket.onerror=this.onClose.bind(this),this.socket.onclose=this.onClose.bind(this)},a.prototype.resume=function(a){},a.prototype.onOpen=function(){this.progress=1,this.established=!0},a.prototype.onClose=function(){this.shouldAttemptReconnect&&(clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=setTimeout(function(){this.start()}.bind(this),1e3*this.reconnectInterval))},a.prototype.onMessage=function(a){this.destination&&this.destination.write(a.data)},a}();
JSMpeg.Demuxer.TS=function(){"use strict";var a=function(a){this.bits=null,this.leftoverBytes=null,this.guessVideoFrameEnd=!0,this.pidsToStreamIds={},this.pesPacketInfo={},this.startTime=0,this.currentTime=0};return a.prototype.connect=function(a,b){this.pesPacketInfo[a]={destination:b,currentLength:0,totalLength:0,pts:0,buffers:[]}},a.prototype.write=function(a){if(this.leftoverBytes){var b=a.byteLength+this.leftoverBytes.byteLength;this.bits=new JSMpeg.BitBuffer(b),this.bits.write([this.leftoverBytes,a])}else this.bits=new JSMpeg.BitBuffer(a);for(;this.bits.has(1504)&&this.parsePacket(););var c=this.bits.byteLength-(this.bits.index>>3);this.leftoverBytes=c>0?this.bits.bytes.subarray(this.bits.index>>3):null},a.prototype.parsePacket=function(){if(71!==this.bits.read(8)&&!this.resync())return!1;var a=(this.bits.index>>3)+187,b=(this.bits.read(1),this.bits.read(1)),c=(this.bits.read(1),this.bits.read(13)),d=(this.bits.read(2),this.bits.read(2)),e=(this.bits.read(4),this.pidsToStreamIds[c]);if(b&&e){var f=this.pesPacketInfo[e];f&&f.currentLength&&this.packetComplete(f)}if(1&d){if(2&d){var g=this.bits.read(8);this.bits.skip(g<<3)}if(b&&this.bits.nextBytesAreStartCode()){this.bits.skip(24),e=this.bits.read(8),this.pidsToStreamIds[c]=e;var h=this.bits.read(16);this.bits.skip(8);var i=this.bits.read(2);this.bits.skip(6);var j=this.bits.read(8),k=this.bits.index+(j<<3),f=this.pesPacketInfo[e];if(f){var l=0;if(2&i){this.bits.skip(4);var m=this.bits.read(3);this.bits.skip(1);var n=this.bits.read(15);this.bits.skip(1);var o=this.bits.read(15);this.bits.skip(1),l=(1073741824*m+32768*n+o)/9e4,this.currentTime=l,-1===this.startTime&&(this.startTime=l)}var p=h?h-j-3:0;this.packetStart(f,l,p)}this.bits.index=k}if(e){var f=this.pesPacketInfo[e];if(f){var q=this.bits.index>>3,r=this.packetAddData(f,q,a),s=!b&&2&d;(r||this.guessVideoFrameEnd&&s)&&this.packetComplete(f)}}}return this.bits.index=a<<3,!0},a.prototype.resync=function(){if(!this.bits.has(9024))return!1;for(var a=this.bits.index>>3,b=0;187>b;b++)if(71===this.bits.bytes[a+b]){for(var c=!0,d=1;5>d;d++)if(71!==this.bits.bytes[a+b+188*d]){c=!1;break}if(c)return this.bits.index=a+b+1<<3,!0}return console.warn("JSMpeg: Possible garbage data. Skipping."),this.bits.skip(1496),!1},a.prototype.packetStart=function(a,b,c){a.totalLength=c,a.currentLength=0,a.pts=b},a.prototype.packetAddData=function(a,b,c){a.buffers.push(this.bits.bytes.subarray(b,c)),a.currentLength+=c-b;var d=0!==a.totalLength&&a.currentLength>=a.totalLength;return d},a.prototype.packetComplete=function(a){a.destination.write(a.pts,a.buffers),a.totalLength=0,a.currentLength=0,a.buffers=[]},a.STREAM={PACK_HEADER:186,SYSTEM_HEADER:187,PROGRAM_MAP:188,PRIVATE_1:189,PADDING:190,PRIVATE_2:191,AUDIO_1:192,VIDEO_1:224,DIRECTORY:255},a}();
JSMpeg.Decoder.Base=function(){"use strict";var a=function(a){this.destination=null,this.canPlay=!1,this.collectTimestamps=!a.streaming,this.timestamps=[],this.timestampIndex=0,this.startTime=0,this.decodedTime=0,Object.defineProperty(this,"currentTime",{get:this.getCurrentTime})};return a.prototype.connect=function(a){this.destination=a},a.prototype.write=function(a,b){this.collectTimestamps&&(0===this.timestamps.length&&(this.startTime=a,this.decodedTime=a),this.timestamps.push({index:this.bits.byteLength<<3,time:a})),this.bits.write(b),this.canPlay=!0},a.prototype.seek=function(a){if(this.collectTimestamps){this.timestampIndex=0;for(var b=0;b<this.timestamps.length&&!(this.timestamps[b].time>a);b++)this.timestampIndex=b;var c=this.timestamps[this.timestampIndex];c?(this.bits.index=c.index,this.decodedTime=c.time):(this.bits.index=0,this.decodedTime=this.startTime)}},a.prototype.decode=function(){this.advanceDecodedTime(0)},a.prototype.advanceDecodedTime=function(a){if(this.collectTimestamps){for(var b=-1,c=this.timestampIndex;c<this.timestamps.length&&!(this.timestamps[c].index>this.bits.index);c++)b=c;if(-1!==b&&b!==this.timestampIndex)return this.timestampIndex=b,void(this.decodedTime=this.timestamps[this.timestampIndex].time)}this.decodedTime+=a},a.prototype.getCurrentTime=function(){return this.decodedTime},a}();
JSMpeg.Decoder.MPEG1Video=function(){"use strict";var a=function(a){JSMpeg.Decoder.Base.call(this,a);var b=a.videoBufferSize||524288,c=a.streaming?JSMpeg.BitBuffer.MODE.EVICT:JSMpeg.BitBuffer.MODE.EXPAND;this.bits=new JSMpeg.BitBuffer(b,c),this.customIntraQuantMatrix=new Uint8Array(64),this.customNonIntraQuantMatrix=new Uint8Array(64),this.blockData=new Int32Array(64),this.currentFrame=0,this.decodeFirstFrame=a.decodeFirstFrame!==!1};return a.prototype=Object.create(JSMpeg.Decoder.Base.prototype),a.prototype.constructor=a,a.prototype.write=function(b,c){if(JSMpeg.Decoder.Base.prototype.write.call(this,b,c),!this.hasSequenceHeader){if(-1===this.bits.findStartCode(a.START.SEQUENCE))return!1;this.decodeSequenceHeader(),this.decodeFirstFrame&&this.decode()}},a.prototype.decode=function(){if(!this.hasSequenceHeader)return!1;if(-1===this.bits.findStartCode(a.START.PICTURE)){this.bits.byteLength-(this.bits.index>>3);return!1}return this.decodePicture(),this.advanceDecodedTime(1/this.frameRate),!0},a.prototype.readHuffman=function(a){var b=0;do b=a[b+this.bits.read(1)];while(b>=0&&0!==a[b]);return a[b+2]},a.prototype.frameRate=30,a.prototype.decodeSequenceHeader=function(){var b=this.bits.read(12),c=this.bits.read(12);if(this.bits.skip(4),this.frameRate=a.PICTURE_RATE[this.bits.read(4)],this.bits.skip(30),(b!==this.width||c!==this.height)&&(this.width=b,this.height=c,this.initBuffers(),this.destination&&this.destination.resize(b,c)),this.bits.read(1)){for(var d=0;64>d;d++)this.customIntraQuantMatrix[a.ZIG_ZAG[d]]=this.bits.read(8);this.intraQuantMatrix=this.customIntraQuantMatrix}if(this.bits.read(1)){for(var d=0;64>d;d++){var e=a.ZIG_ZAG[d];this.customNonIntraQuantMatrix[e]=this.bits.read(8)}this.nonIntraQuantMatrix=this.customNonIntraQuantMatrix}this.hasSequenceHeader=!0},a.prototype.initBuffers=function(){this.intraQuantMatrix=a.DEFAULT_INTRA_QUANT_MATRIX,this.nonIntraQuantMatrix=a.DEFAULT_NON_INTRA_QUANT_MATRIX,this.mbWidth=this.width+15>>4,this.mbHeight=this.height+15>>4,this.mbSize=this.mbWidth*this.mbHeight,this.codedWidth=this.mbWidth<<4,this.codedHeight=this.mbHeight<<4,this.codedSize=this.codedWidth*this.codedHeight,this.halfWidth=this.mbWidth<<3,this.halfHeight=this.mbHeight<<3,this.currentY=new Uint8ClampedArray(this.codedSize),this.currentY32=new Uint32Array(this.currentY.buffer),this.currentCr=new Uint8ClampedArray(this.codedSize>>2),this.currentCr32=new Uint32Array(this.currentCr.buffer),this.currentCb=new Uint8ClampedArray(this.codedSize>>2),this.currentCb32=new Uint32Array(this.currentCb.buffer),this.forwardY=new Uint8ClampedArray(this.codedSize),this.forwardY32=new Uint32Array(this.forwardY.buffer),this.forwardCr=new Uint8ClampedArray(this.codedSize>>2),this.forwardCr32=new Uint32Array(this.forwardCr.buffer),this.forwardCb=new Uint8ClampedArray(this.codedSize>>2),this.forwardCb32=new Uint32Array(this.forwardCb.buffer)},a.prototype.currentY=null,a.prototype.currentCr=null,a.prototype.currentCb=null,a.prototype.pictureType=0,a.prototype.forwardY=null,a.prototype.forwardCr=null,a.prototype.forwardCb=null,a.prototype.fullPelForward=!1,a.prototype.forwardFCode=0,a.prototype.forwardRSize=0,a.prototype.forwardF=0,a.prototype.decodePicture=function(b){if(this.currentFrame++,this.bits.skip(10),this.pictureType=this.bits.read(3),this.bits.skip(16),!(this.pictureType<=0||this.pictureType>=a.PICTURE_TYPE.B)){if(this.pictureType===a.PICTURE_TYPE.PREDICTIVE){if(this.fullPelForward=this.bits.read(1),this.forwardFCode=this.bits.read(3),0===this.forwardFCode)return;this.forwardRSize=this.forwardFCode-1,this.forwardF=1<<this.forwardRSize}var c=0;do c=this.bits.findNextStartCode();while(c===a.START.EXTENSION||c===a.START.USER_DATA);for(;c>=a.START.SLICE_FIRST&&c<=a.START.SLICE_LAST;)this.decodeSlice(255&c),c=this.bits.findNextStartCode();if(-1!==c&&this.bits.rewind(32),this.destination&&this.destination.render(this.currentY,this.currentCr,this.currentCb),this.pictureType===a.PICTURE_TYPE.INTRA||this.pictureType===a.PICTURE_TYPE.PREDICTIVE){var d=this.forwardY,e=this.forwardY32,f=this.forwardCr,g=this.forwardCr32,h=this.forwardCb,i=this.forwardCb32;this.forwardY=this.currentY,this.forwardY32=this.currentY32,this.forwardCr=this.currentCr,this.forwardCr32=this.currentCr32,this.forwardCb=this.currentCb,this.forwardCb32=this.currentCb32,this.currentY=d,this.currentY32=e,this.currentCr=f,this.currentCr32=g,this.currentCb=h,this.currentCb32=i}}},a.prototype.quantizerScale=0,a.prototype.sliceBegin=!1,a.prototype.decodeSlice=function(a){for(this.sliceBegin=!0,this.macroblockAddress=(a-1)*this.mbWidth-1,this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0,this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.quantizerScale=this.bits.read(5);this.bits.read(1);)this.bits.skip(8);do this.decodeMacroblock();while(!this.bits.nextBytesAreStartCode())},a.prototype.macroblockAddress=0,a.prototype.mbRow=0,a.prototype.mbCol=0,a.prototype.macroblockType=0,a.prototype.macroblockIntra=!1,a.prototype.macroblockMotFw=!1,a.prototype.motionFwH=0,a.prototype.motionFwV=0,a.prototype.motionFwHPrev=0,a.prototype.motionFwVPrev=0,a.prototype.decodeMacroblock=function(){for(var b=0,c=this.readHuffman(a.MACROBLOCK_ADDRESS_INCREMENT);34===c;)c=this.readHuffman(a.MACROBLOCK_ADDRESS_INCREMENT);for(;35===c;)b+=33,c=this.readHuffman(a.MACROBLOCK_ADDRESS_INCREMENT);if(b+=c,this.sliceBegin)this.sliceBegin=!1,this.macroblockAddress+=b;else{if(this.macroblockAddress+b>=this.mbSize)return;for(b>1&&(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.pictureType===a.PICTURE_TYPE.PREDICTIVE&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0));b>1;)this.macroblockAddress++,this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth,this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb),b--;this.macroblockAddress++}this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth;var d=a.MACROBLOCK_TYPE[this.pictureType];this.macroblockType=this.readHuffman(d),this.macroblockIntra=1&this.macroblockType,this.macroblockMotFw=8&this.macroblockType,0!==(16&this.macroblockType)&&(this.quantizerScale=this.bits.read(5)),this.macroblockIntra?(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0):(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.decodeMotionVectors(),this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb));for(var e=0!==(2&this.macroblockType)?this.readHuffman(a.CODE_BLOCK_PATTERN):this.macroblockIntra?63:0,f=0,g=32;6>f;f++)0!==(e&g)&&this.decodeBlock(f),g>>=1},a.prototype.decodeMotionVectors=function(){var b,c,d=0;this.macroblockMotFw?(b=this.readHuffman(a.MOTION),0!==b&&1!==this.forwardF?(d=this.bits.read(this.forwardRSize),c=(Math.abs(b)-1<<this.forwardRSize)+d+1,0>b&&(c=-c)):c=b,this.motionFwHPrev+=c,this.motionFwHPrev>(this.forwardF<<4)-1?this.motionFwHPrev-=this.forwardF<<5:this.motionFwHPrev<-this.forwardF<<4&&(this.motionFwHPrev+=this.forwardF<<5),this.motionFwH=this.motionFwHPrev,this.fullPelForward&&(this.motionFwH<<=1),b=this.readHuffman(a.MOTION),0!==b&&1!==this.forwardF?(d=this.bits.read(this.forwardRSize),c=(Math.abs(b)-1<<this.forwardRSize)+d+1,0>b&&(c=-c)):c=b,this.motionFwVPrev+=c,this.motionFwVPrev>(this.forwardF<<4)-1?this.motionFwVPrev-=this.forwardF<<5:this.motionFwVPrev<-this.forwardF<<4&&(this.motionFwVPrev+=this.forwardF<<5),this.motionFwV=this.motionFwVPrev,this.fullPelForward&&(this.motionFwV<<=1)):this.pictureType===a.PICTURE_TYPE.PREDICTIVE&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0)},a.prototype.copyMacroblock=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o=this.currentY32,p=this.currentCb32,q=this.currentCr32;f=this.codedWidth,g=f-16,h=a>>1,i=b>>1,j=1===(1&a),k=1===(1&b),l=((this.mbRow<<4)+i)*f+(this.mbCol<<4)+h,m=this.mbRow*f+this.mbCol<<2,n=m+(f<<2);var r,s,t,u;if(j)if(k)for(;n>m;){for(s=c[l]+c[l+f],l++,r=0;4>r;r++)t=c[l]+c[l+f],l++,u=s+t+2>>2&255,s=c[l]+c[l+f],l++,u|=s+t+2<<6&65280,t=c[l]+c[l+f],l++,u|=s+t+2<<14&16711680,s=c[l]+c[l+f],l++,u|=s+t+2<<22&4278190080,o[m++]=u;m+=g>>2,l+=g-1}else for(;n>m;){for(s=c[l++],r=0;4>r;r++)t=c[l++],u=s+t+1>>1&255,s=c[l++],u|=s+t+1<<7&65280,t=c[l++],u|=s+t+1<<15&16711680,s=c[l++],u|=s+t+1<<23&4278190080,o[m++]=u;m+=g>>2,l+=g-1}else if(k)for(;n>m;){for(r=0;4>r;r++)u=c[l]+c[l+f]+1>>1&255,l++,u|=c[l]+c[l+f]+1<<7&65280,l++,u|=c[l]+c[l+f]+1<<15&16711680,l++,u|=c[l]+c[l+f]+1<<23&4278190080,l++,o[m++]=u;m+=g>>2,l+=g}else for(;n>m;){for(r=0;4>r;r++)u=c[l],l++,u|=c[l]<<8,l++,u|=c[l]<<16,l++,u|=c[l]<<24,l++,o[m++]=u;m+=g>>2,l+=g}f=this.halfWidth,g=f-8,h=a/2>>1,i=b/2>>1,j=1===(a/2&1),k=1===(b/2&1),l=((this.mbRow<<3)+i)*f+(this.mbCol<<3)+h,m=this.mbRow*f+this.mbCol<<1,n=m+(f<<1);var v,w,x,y,z,A;if(j)if(k)for(;n>m;){for(v=d[l]+d[l+f],y=e[l]+e[l+f],l++,r=0;2>r;r++)w=d[l]+d[l+f],z=e[l]+e[l+f],l++,x=v+w+2>>2&255,A=y+z+2>>2&255,v=d[l]+d[l+f],y=e[l]+e[l+f],l++,x|=v+w+2<<6&65280,A|=y+z+2<<6&65280,w=d[l]+d[l+f],z=e[l]+e[l+f],l++,x|=v+w+2<<14&16711680,A|=y+z+2<<14&16711680,v=d[l]+d[l+f],y=e[l]+e[l+f],l++,x|=v+w+2<<22&4278190080,A|=y+z+2<<22&4278190080,q[m]=x,p[m]=A,m++;m+=g>>2,l+=g-1}else for(;n>m;){for(v=d[l],y=e[l],l++,r=0;2>r;r++)w=d[l],z=e[l++],x=v+w+1>>1&255,A=y+z+1>>1&255,v=d[l],y=e[l++],x|=v+w+1<<7&65280,A|=y+z+1<<7&65280,w=d[l],z=e[l++],x|=v+w+1<<15&16711680,A|=y+z+1<<15&16711680,v=d[l],y=e[l++],x|=v+w+1<<23&4278190080,A|=y+z+1<<23&4278190080,q[m]=x,p[m]=A,m++;m+=g>>2,l+=g-1}else if(k)for(;n>m;){for(r=0;2>r;r++)x=d[l]+d[l+f]+1>>1&255,A=e[l]+e[l+f]+1>>1&255,l++,x|=d[l]+d[l+f]+1<<7&65280,A|=e[l]+e[l+f]+1<<7&65280,l++,x|=d[l]+d[l+f]+1<<15&16711680,A|=e[l]+e[l+f]+1<<15&16711680,l++,x|=d[l]+d[l+f]+1<<23&4278190080,A|=e[l]+e[l+f]+1<<23&4278190080,l++,q[m]=x,p[m]=A,m++;m+=g>>2,l+=g}else for(;n>m;){for(r=0;2>r;r++)x=d[l],A=e[l],l++,x|=d[l]<<8,A|=e[l]<<8,l++,x|=d[l]<<16,A|=e[l]<<16,l++,x|=d[l]<<24,A|=e[l]<<24,l++,q[m]=x,p[m]=A,m++;m+=g>>2,l+=g}},a.prototype.dcPredictorY=0,a.prototype.dcPredictorCr=0,a.prototype.dcPredictorCb=0,a.prototype.blockData=null,a.prototype.decodeBlock=function(b){var c,d=0;if(this.macroblockIntra){var e,f;if(4>b?(e=this.dcPredictorY,f=this.readHuffman(a.DCT_DC_SIZE_LUMINANCE)):(e=4===b?this.dcPredictorCr:this.dcPredictorCb,f=this.readHuffman(a.DCT_DC_SIZE_CHROMINANCE)),f>0){var g=this.bits.read(f);0!==(g&1<<f-1)?this.blockData[0]=e+g:this.blockData[0]=e+(-1<<f|g+1)}else this.blockData[0]=e;4>b?this.dcPredictorY=this.blockData[0]:4===b?this.dcPredictorCr=this.blockData[0]:this.dcPredictorCb=this.blockData[0],this.blockData[0]<<=8,c=this.intraQuantMatrix,d=1}else c=this.nonIntraQuantMatrix;for(var h=0;;){var i=0,j=this.readHuffman(a.DCT_COEFF);if(1===j&&d>0&&0===this.bits.read(1))break;65535===j?(i=this.bits.read(6),h=this.bits.read(8),0===h?h=this.bits.read(8):128===h?h=this.bits.read(8)-256:h>128&&(h-=256)):(i=j>>8,h=255&j,this.bits.read(1)&&(h=-h)),d+=i;var k=a.ZIG_ZAG[d];d++,h<<=1,this.macroblockIntra||(h+=0>h?-1:1),h=h*this.quantizerScale*c[k]>>4,0===(1&h)&&(h-=h>0?1:-1),h>2047?h=2047:-2048>h&&(h=-2048),this.blockData[k]=h*a.PREMULTIPLIER_MATRIX[k]}var l,m,n;4>b?(l=this.currentY,n=this.codedWidth-8,m=this.mbRow*this.codedWidth+this.mbCol<<4,0!==(1&b)&&(m+=8),0!==(2&b)&&(m+=this.codedWidth<<3)):(l=4===b?this.currentCb:this.currentCr,n=(this.codedWidth>>1)-8,m=(this.mbRow*this.codedWidth<<2)+(this.mbCol<<3)),this.macroblockIntra?1===d?(a.CopyValueToDestination(this.blockData[0]+128>>8,l,m,n),this.blockData[0]=0):(a.IDCT(this.blockData),a.CopyBlockToDestination(this.blockData,l,m,n),JSMpeg.Fill(this.blockData,0)):1===d?(a.AddValueToDestination(this.blockData[0]+128>>8,l,m,n),this.blockData[0]=0):(a.IDCT(this.blockData),a.AddBlockToDestination(this.blockData,l,m,n),JSMpeg.Fill(this.blockData,0)),d=0},a.CopyBlockToDestination=function(a,b,c,d){for(var e=0;64>e;e+=8,c+=d+8)b[c+0]=a[e+0],b[c+1]=a[e+1],b[c+2]=a[e+2],b[c+3]=a[e+3],b[c+4]=a[e+4],b[c+5]=a[e+5],b[c+6]=a[e+6],b[c+7]=a[e+7]},a.AddBlockToDestination=function(a,b,c,d){for(var e=0;64>e;e+=8,c+=d+8)b[c+0]+=a[e+0],b[c+1]+=a[e+1],b[c+2]+=a[e+2],b[c+3]+=a[e+3],b[c+4]+=a[e+4],b[c+5]+=a[e+5],b[c+6]+=a[e+6],b[c+7]+=a[e+7]},a.CopyValueToDestination=function(a,b,c,d){for(var e=0;64>e;e+=8,c+=d+8)b[c+0]=a,b[c+1]=a,b[c+2]=a,b[c+3]=a,b[c+4]=a,b[c+5]=a,b[c+6]=a,b[c+7]=a},a.AddValueToDestination=function(a,b,c,d){for(var e=0;64>e;e+=8,c+=d+8)b[c+0]+=a,b[c+1]+=a,b[c+2]+=a,b[c+3]+=a,b[c+4]+=a,b[c+5]+=a,b[c+6]+=a,b[c+7]+=a},a.IDCT=function(a){for(var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=0;8>t;++t)b=a[32+t],c=a[16+t]+a[48+t],d=a[40+t]-a[24+t],g=a[8+t]+a[56+t],h=a[24+t]+a[40+t],e=a[8+t]-a[56+t],f=g+h,i=a[0+t],n=(473*e-196*d+128>>8)-f,j=n-(362*(g-h)+128>>8),k=i-b,l=(362*(a[16+t]-a[48+t])+128>>8)-c,m=i+b,o=k+l,p=m+c,q=k-l,r=m-c,s=-j-(473*d+196*e+128>>8),a[0+t]=f+p,a[8+t]=n+o,a[16+t]=q-j,a[24+t]=r-s,a[32+t]=r+s,a[40+t]=j+q,a[48+t]=o-n,a[56+t]=p-f;for(var t=0;64>t;t+=8)b=a[4+t],c=a[2+t]+a[6+t],d=a[5+t]-a[3+t],g=a[1+t]+a[7+t],h=a[3+t]+a[5+t],e=a[1+t]-a[7+t],f=g+h,i=a[0+t],n=(473*e-196*d+128>>8)-f,j=n-(362*(g-h)+128>>8),k=i-b,l=(362*(a[2+t]-a[6+t])+128>>8)-c,m=i+b,o=k+l,p=m+c,q=k-l,r=m-c,s=-j-(473*d+196*e+128>>8),a[0+t]=f+p+128>>8,a[1+t]=n+o+128>>8,a[2+t]=q-j+128>>8,a[3+t]=r-s+128>>8,a[4+t]=r+s+128>>8,a[5+t]=j+q+128>>8,a[6+t]=o-n+128>>8,a[7+t]=p-f+128>>8},a.PICTURE_RATE=[0,23.976,24,25,29.97,30,50,59.94,60,0,0,0,0,0,0,0],a.ZIG_ZAG=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),a.DEFAULT_INTRA_QUANT_MATRIX=new Uint8Array([8,16,19,22,26,27,29,34,16,16,22,24,27,29,34,37,19,22,26,27,29,34,34,38,22,22,26,27,29,34,37,40,22,26,27,29,32,35,40,48,26,27,29,32,35,40,48,58,26,27,29,34,38,46,56,69,27,29,35,38,46,56,69,83]),a.DEFAULT_NON_INTRA_QUANT_MATRIX=new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),a.PREMULTIPLIER_MATRIX=new Uint8Array([32,44,42,38,32,25,17,9,44,62,58,52,44,35,24,12,42,58,55,49,42,33,23,12,38,52,49,44,38,30,20,10,32,44,42,38,32,25,17,9,25,35,33,30,25,20,14,7,17,24,23,20,17,14,9,5,9,12,12,10,9,7,5,2]),a.MACROBLOCK_ADDRESS_INCREMENT=new Int16Array([3,6,0,9,12,0,0,0,1,15,18,0,21,24,0,27,30,0,33,36,0,0,0,3,0,0,2,39,42,0,45,48,0,0,0,5,0,0,4,51,54,0,57,60,0,0,0,7,0,0,6,63,66,0,69,72,0,75,78,0,81,84,0,-1,87,0,-1,90,0,93,96,0,99,102,0,105,108,0,111,114,0,0,0,9,0,0,8,117,120,0,123,126,0,129,132,0,135,138,0,0,0,15,0,0,14,0,0,13,0,0,12,0,0,11,0,0,10,141,-1,0,-1,144,0,147,150,0,153,156,0,159,162,0,165,168,0,171,174,0,177,180,0,183,-1,0,-1,186,0,189,192,0,195,198,0,201,204,0,207,210,0,213,216,0,219,222,0,0,0,21,0,0,20,0,0,19,0,0,18,0,0,17,0,0,16,0,0,35,0,0,34,0,0,33,0,0,32,0,0,31,0,0,30,0,0,29,0,0,28,0,0,27,0,0,26,0,0,25,0,0,24,0,0,23,0,0,22]),a.MACROBLOCK_TYPE_INTRA=new Int8Array([3,6,0,-1,9,0,0,0,1,0,0,17]),a.MACROBLOCK_TYPE_PREDICTIVE=new Int8Array([3,6,0,9,12,0,0,0,10,15,18,0,0,0,2,21,24,0,0,0,8,27,30,0,33,36,0,-1,39,0,0,0,18,0,0,26,0,0,1,0,0,17]),a.MACROBLOCK_TYPE_B=new Int8Array([3,6,0,9,15,0,12,18,0,24,21,0,0,0,12,27,30,0,0,0,14,39,42,0,36,33,0,0,0,4,0,0,6,54,48,0,45,51,0,0,0,8,0,0,10,-1,57,0,0,0,1,60,63,0,0,0,30,0,0,17,0,0,22,0,0,26]),a.MACROBLOCK_TYPE=[null,a.MACROBLOCK_TYPE_INTRA,a.MACROBLOCK_TYPE_PREDICTIVE,a.MACROBLOCK_TYPE_B],a.CODE_BLOCK_PATTERN=new Int16Array([6,3,0,9,18,0,12,15,0,24,33,0,36,39,0,27,21,0,30,42,0,60,57,0,54,48,0,69,51,0,81,75,0,63,84,0,45,66,0,72,78,0,0,0,60,105,120,0,132,144,0,114,108,0,126,141,0,87,93,0,117,96,0,0,0,32,135,138,0,99,123,0,129,102,0,0,0,4,90,111,0,0,0,8,0,0,16,0,0,44,150,168,0,0,0,28,0,0,52,0,0,62,183,177,0,156,180,0,0,0,1,165,162,0,0,0,61,0,0,56,171,174,0,0,0,2,0,0,40,153,186,0,0,0,48,192,189,0,147,159,0,0,0,20,0,0,12,240,249,0,0,0,63,231,225,0,195,219,0,252,198,0,0,0,24,0,0,36,0,0,3,207,261,0,243,237,0,204,213,0,210,234,0,201,228,0,216,222,0,258,255,0,264,246,0,-1,282,0,285,291,0,0,0,33,0,0,9,318,330,0,306,348,0,0,0,5,0,0,10,279,267,0,0,0,6,0,0,18,0,0,17,0,0,34,339,357,0,309,312,0,270,276,0,327,321,0,351,354,0,303,297,0,294,288,0,300,273,0,342,345,0,315,324,0,336,333,0,363,375,0,0,0,41,0,0,14,0,0,21,372,366,0,360,369,0,0,0,11,0,0,19,0,0,7,0,0,35,0,0,13,0,0,50,0,0,49,0,0,58,0,0,37,0,0,25,0,0,45,0,0,57,0,0,26,0,0,29,0,0,38,0,0,53,0,0,23,0,0,43,0,0,46,0,0,42,0,0,22,0,0,54,0,0,51,0,0,15,0,0,30,0,0,39,0,0,47,0,0,55,0,0,27,0,0,59,0,0,31]),a.MOTION=new Int16Array([3,6,0,12,9,0,0,0,0,18,15,0,24,21,0,0,0,-1,0,0,1,27,30,0,36,33,0,0,0,2,0,0,-2,42,45,0,48,39,0,60,54,0,0,0,3,0,0,-3,51,57,0,-1,69,0,81,75,0,78,63,0,72,66,0,96,84,0,87,93,0,-1,99,0,108,105,0,0,0,-4,90,102,0,0,0,4,0,0,-7,0,0,5,111,123,0,0,0,-5,0,0,7,114,120,0,126,117,0,0,0,-6,0,0,6,153,162,0,150,147,0,135,138,0,156,141,0,129,159,0,132,144,0,0,0,10,0,0,9,0,0,8,0,0,-8,171,198,0,0,0,-9,180,192,0,168,183,0,165,186,0,174,189,0,0,0,-10,177,195,0,0,0,12,0,0,16,0,0,13,0,0,14,0,0,11,0,0,15,0,0,-16,0,0,-12,0,0,-14,0,0,-15,0,0,-11,0,0,-13]),a.DCT_DC_SIZE_LUMINANCE=new Int8Array([6,3,0,18,15,0,9,12,0,0,0,1,0,0,2,27,24,0,21,30,0,0,0,0,36,33,0,0,0,4,0,0,3,39,42,0,0,0,5,0,0,6,48,45,0,51,-1,0,0,0,7,0,0,8]),a.DCT_DC_SIZE_CHROMINANCE=new Int8Array([6,3,0,12,9,0,18,15,0,24,21,0,0,0,2,0,0,1,0,0,0,30,27,0,0,0,3,36,33,0,0,0,4,42,39,0,0,0,5,48,45,0,0,0,6,51,-1,0,0,0,7,0,0,8]),a.DCT_COEFF=new Int32Array([3,6,0,12,9,0,0,0,1,21,24,0,18,15,0,39,27,0,33,30,0,42,36,0,0,0,257,60,66,0,54,63,0,48,57,0,0,0,513,51,45,0,0,0,2,0,0,3,81,75,0,87,93,0,72,78,0,96,90,0,0,0,1025,69,84,0,0,0,769,0,0,258,0,0,1793,0,0,65535,0,0,1537,111,108,0,0,0,1281,105,102,0,117,114,0,99,126,0,120,123,0,156,150,0,162,159,0,144,147,0,129,135,0,138,132,0,0,0,2049,0,0,4,0,0,514,0,0,2305,153,141,0,165,171,0,180,168,0,177,174,0,183,186,0,0,0,2561,0,0,3329,0,0,6,0,0,259,0,0,5,0,0,770,0,0,2817,0,0,3073,228,225,0,201,210,0,219,213,0,234,222,0,216,231,0,207,192,0,204,189,0,198,195,0,243,261,0,273,240,0,246,237,0,249,258,0,279,276,0,252,255,0,270,282,0,264,267,0,0,0,515,0,0,260,0,0,7,0,0,1026,0,0,1282,0,0,4097,0,0,3841,0,0,3585,315,321,0,333,342,0,312,291,0,375,357,0,288,294,0,-1,369,0,285,303,0,318,363,0,297,306,0,339,309,0,336,348,0,330,300,0,372,345,0,351,366,0,327,354,0,360,324,0,381,408,0,417,420,0,390,378,0,435,438,0,384,387,0,0,0,2050,396,402,0,465,462,0,0,0,8,411,399,0,429,432,0,453,414,0,426,423,0,0,0,10,0,0,9,0,0,11,0,0,5377,0,0,1538,0,0,771,0,0,5121,0,0,1794,0,0,4353,0,0,4609,0,0,4865,444,456,0,0,0,1027,459,450,0,0,0,261,393,405,0,0,0,516,447,441,0,516,519,0,486,474,0,510,483,0,504,498,0,471,537,0,507,501,0,522,513,0,534,531,0,468,477,0,492,495,0,549,546,0,525,528,0,0,0,263,0,0,2562,0,0,2306,0,0,5633,0,0,5889,0,0,6401,0,0,6145,0,0,1283,0,0,772,0,0,13,0,0,12,0,0,14,0,0,15,0,0,517,0,0,6657,0,0,262,540,543,0,480,489,0,588,597,0,0,0,27,609,555,0,606,603,0,0,0,19,0,0,22,591,621,0,0,0,18,573,576,0,564,570,0,0,0,20,552,582,0,0,0,21,558,579,0,0,0,23,612,594,0,0,0,25,0,0,24,600,615,0,0,0,31,0,0,30,0,0,28,0,0,29,0,0,26,0,0,17,0,0,16,567,618,0,561,585,0,654,633,0,0,0,37,645,648,0,0,0,36,630,636,0,0,0,34,639,627,0,663,666,0,657,624,0,651,642,0,669,660,0,0,0,35,0,0,267,0,0,40,0,0,268,0,0,266,0,0,32,0,0,264,0,0,265,0,0,38,0,0,269,0,0,270,0,0,33,0,0,39,0,0,7937,0,0,6913,0,0,7681,0,0,4098,0,0,7425,0,0,7169,0,0,271,0,0,274,0,0,273,0,0,272,0,0,1539,0,0,2818,0,0,3586,0,0,3330,0,0,3074,0,0,3842]),a.PICTURE_TYPE={INTRA:1,PREDICTIVE:2,B:3},a.START={SEQUENCE:179,SLICE_FIRST:1,SLICE_LAST:175,PICTURE:0,EXTENSION:181,USER_DATA:178},a}();
JSMpeg.Decoder.MP2Audio=function(){"use strict";var a=function(b){JSMpeg.Decoder.Base.call(this,b);var c=b.audioBufferSize||131072,d=b.streaming?JSMpeg.BitBuffer.MODE.EVICT:JSMpeg.BitBuffer.MODE.EXPAND;this.bits=new JSMpeg.BitBuffer(c,d),this.left=new Float32Array(1152),this.right=new Float32Array(1152),this.sampleRate=44100,this.D=new Float32Array(1024),this.D.set(a.SYNTHESIS_WINDOW,0),this.D.set(a.SYNTHESIS_WINDOW,512),this.V=new Float32Array(1024),this.U=new Int32Array(32),this.VPos=0,this.allocation=[new Array(32),new Array(32)],this.scaleFactorInfo=[new Uint8Array(32),new Uint8Array(32)],this.scaleFactor=[new Array(32),new Array(32)],this.sample=[new Array(32),new Array(32)];for(var e=0;2>e;e++)for(var f=0;32>f;f++)this.scaleFactor[e][f]=[0,0,0],this.sample[e][f]=[0,0,0]};return a.prototype=Object.create(JSMpeg.Decoder.Base.prototype),a.prototype.constructor=a,a.prototype.decode=function(){var a=this.bits.index>>3;if(a>=this.bits.byteLength)return!1;var b=this.decodeFrame(this.left,this.right);return this.bits.index=a+b<<3,b?(this.destination&&this.destination.play(this.sampleRate,this.left,this.right),this.advanceDecodedTime(this.left.length/this.sampleRate),!0):!1},a.prototype.getCurrentTime=function(){var a=this.destination?this.destination.enqueuedTime:0;return this.decodedTime-a},a.prototype.decodeFrame=function(b,c){var d=this.bits.read(11),e=this.bits.read(2),f=this.bits.read(2),g=!this.bits.read(1);if(d!==a.FRAME_SYNC||e!==a.VERSION.MPEG_1||f!==a.LAYER.II)return 0;var h=this.bits.read(4)-1;if(h>13)return 0;var i=this.bits.read(2),j=a.SAMPLE_RATE[i];if(3===i)return 0;e===a.VERSION.MPEG_2&&(i+=4,h+=14);var k=this.bits.read(1),l=(this.bits.read(1),this.bits.read(2)),m=0;l===a.MODE.JOINT_STEREO?m=this.bits.read(2)+1<<2:(this.bits.skip(2),m=l===a.MODE.MONO?0:32),this.bits.skip(4),g&&this.bits.skip(16);var n=a.BIT_RATE[h],j=a.SAMPLE_RATE[i],o=144e3*n/j+k|0,p=0,q=0;if(e===a.VERSION.MPEG_2)p=2,q=30;else{var r=l===a.MODE.MONO?0:1,s=a.QUANT_LUT_STEP_1[r][h];p=a.QUANT_LUT_STEP_2[s][i],q=63&p,p>>=6}m>q&&(m=q);for(var t=0;m>t;t++)this.allocation[0][t]=this.readAllocation(t,p),this.allocation[1][t]=this.readAllocation(t,p);for(var t=m;q>t;t++)this.allocation[0][t]=this.allocation[1][t]=this.readAllocation(t,p);for(var u=l===a.MODE.MONO?1:2,t=0;q>t;t++){for(v=0;u>v;v++)this.allocation[v][t]&&(this.scaleFactorInfo[v][t]=this.bits.read(2));l===a.MODE.MONO&&(this.scaleFactorInfo[1][t]=this.scaleFactorInfo[0][t])}for(var t=0;q>t;t++){for(var v=0;u>v;v++)if(this.allocation[v][t]){var w=this.scaleFactor[v][t];switch(this.scaleFactorInfo[v][t]){case 0:w[0]=this.bits.read(6),w[1]=this.bits.read(6),w[2]=this.bits.read(6);break;case 1:w[0]=w[1]=this.bits.read(6),w[2]=this.bits.read(6);break;case 2:w[0]=w[1]=w[2]=this.bits.read(6);break;case 3:w[0]=this.bits.read(6),w[1]=w[2]=this.bits.read(6)}}l===a.MODE.MONO&&(this.scaleFactor[1][t][0]=this.scaleFactor[0][t][0],this.scaleFactor[1][t][1]=this.scaleFactor[0][t][1],this.scaleFactor[1][t][2]=this.scaleFactor[0][t][2])}for(var x=0,y=0;3>y;y++)for(var z=0;4>z;z++){for(var t=0;m>t;t++)this.readSamples(0,t,y),this.readSamples(1,t,y);for(var t=m;q>t;t++)this.readSamples(0,t,y),this.sample[1][t][0]=this.sample[0][t][0],this.sample[1][t][1]=this.sample[0][t][1],this.sample[1][t][2]=this.sample[0][t][2];for(var t=q;32>t;t++)this.sample[0][t][0]=0,this.sample[0][t][1]=0,this.sample[0][t][2]=0,this.sample[1][t][0]=0,this.sample[1][t][1]=0,this.sample[1][t][2]=0;for(var A=0;3>A;A++){this.VPos=this.VPos-64&1023;for(var v=0;2>v;v++){a.MatrixTransform(this.sample[v],A,this.V,this.VPos),JSMpeg.Fill(this.U,0);for(var B=512-(this.VPos>>1),C=this.VPos%128>>1;1024>C;){for(var D=0;32>D;++D)this.U[D]+=this.D[B++]*this.V[C++];C+=96,B+=32}for(C=1120-C,B-=480;1024>C;){for(var D=0;32>D;++D)this.U[D]+=this.D[B++]*this.V[C++];C+=96,B+=32}for(var E=0===v?b:c,F=0;32>F;F++)E[x+F]=this.U[F]/2147418112}x+=32}}return this.sampleRate=j,o},a.prototype.readAllocation=function(b,c){var d=a.QUANT_LUT_STEP_3[c][b],e=a.QUANT_LUT_STEP4[15&d][this.bits.read(d>>4)];return e?a.QUANT_TAB[e-1]:0},a.prototype.readSamples=function(b,c,d){var e=this.allocation[b][c],f=this.scaleFactor[b][c][d],g=this.sample[b][c],h=0;if(!e)return void(g[0]=g[1]=g[2]=0);if(63===f)f=0;else{var i=f/3|0;f=a.SCALEFACTOR_BASE[f%3]+(1<<i>>1)>>i}var j=e.levels;e.group?(h=this.bits.read(e.bits),g[0]=h%j,h=h/j|0,g[1]=h%j,g[2]=h/j|0):(g[0]=this.bits.read(e.bits),g[1]=this.bits.read(e.bits),g[2]=this.bits.read(e.bits));var k=65536/(j+1)|0;j=(j+1>>1)-1,h=(j-g[0])*k,g[0]=h*(f>>12)+(h*(4095&f)+2048>>12)>>12,h=(j-g[1])*k,g[1]=h*(f>>12)+(h*(4095&f)+2048>>12)>>12,h=(j-g[2])*k,g[2]=h*(f>>12)+(h*(4095&f)+2048>>12)>>12},a.MatrixTransform=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;e=a[0][b]+a[31][b],f=.500602998235*(a[0][b]-a[31][b]),g=a[1][b]+a[30][b],h=.505470959898*(a[1][b]-a[30][b]),i=a[2][b]+a[29][b],j=.515447309923*(a[2][b]-a[29][b]),k=a[3][b]+a[28][b],l=.53104259109*(a[3][b]-a[28][b]),m=a[4][b]+a[27][b],n=.553103896034*(a[4][b]-a[27][b]),o=a[5][b]+a[26][b],p=.582934968206*(a[5][b]-a[26][b]),q=a[6][b]+a[25][b],r=.622504123036*(a[6][b]-a[25][b]),s=a[7][b]+a[24][b],t=.674808341455*(a[7][b]-a[24][b]),u=a[8][b]+a[23][b],v=.744536271002*(a[8][b]-a[23][b]),w=a[9][b]+a[22][b],x=.839349645416*(a[9][b]-a[22][b]),y=a[10][b]+a[21][b],z=.972568237862*(a[10][b]-a[21][b]),A=a[11][b]+a[20][b],B=1.16943993343*(a[11][b]-a[20][b]),C=a[12][b]+a[19][b],D=1.48416461631*(a[12][b]-a[19][b]),E=a[13][b]+a[18][b],F=2.05778100995*(a[13][b]-a[18][b]),G=a[14][b]+a[17][b],H=3.40760841847*(a[14][b]-a[17][b]),I=a[15][b]+a[16][b],J=10.1900081235*(a[15][b]-a[16][b]),K=e+I,I=.502419286188*(e-I),e=g+G,G=.52249861494*(g-G),g=i+E,E=.566944034816*(i-E),i=k+C,C=.64682178336*(k-C),k=m+A,A=.788154623451*(m-A),m=o+y,y=1.06067768599*(o-y),o=q+w,w=1.72244709824*(q-w),q=s+u,u=5.10114861869*(s-u),s=K+q,q=.509795579104*(K-q),K=e+o,e=.601344886935*(e-o),o=g+m,m=.899976223136*(g-m),g=i+k,k=2.56291544774*(i-k),i=s+g,s=.541196100146*(s-g),g=K+o,o=1.30656296488*(K-o),K=i+g,i=.707106781187*(i-g),g=s+o,s=.707106781187*(s-o),g+=s,o=q+k,q=.541196100146*(q-k),k=e+m,m=1.30656296488*(e-m),e=o+k,k=.707106781187*(o-k),o=q+m,q=.707106781187*(q-m),o+=q,e+=o,o+=k,k+=q,m=I+u,I=.509795579104*(I-u),u=G+w,G=.601344886935*(G-w),w=E+y,y=.899976223136*(E-y),E=C+A,A=2.56291544774*(C-A),C=m+E,m=.541196100146*(m-E),E=u+w,w=1.30656296488*(u-w),u=C+E,E=.707106781187*(C-E),C=m+w,w=.707106781187*(m-w),C+=w,m=I+A,I=.541196100146*(I-A),A=G+y,y=1.30656296488*(G-y),G=m+A,A=.707106781187*(m-A),m=I+y,I=.707106781187*(I-y),m+=I,G+=m,m+=A,A+=I,u+=G,G+=C,C+=m,m+=E,E+=A,A+=w,w+=I,y=f+J,f=.502419286188*(f-J),J=h+H,h=.52249861494*(h-H),H=j+F,F=.566944034816*(j-F),j=l+D,l=.64682178336*(l-D),D=n+B,n=.788154623451*(n-B),B=p+z,z=1.06067768599*(p-z),p=r+x,x=1.72244709824*(r-x),r=t+v,t=5.10114861869*(t-v),v=y+r,r=.509795579104*(y-r),y=J+p,J=.601344886935*(J-p),p=H+B,B=.899976223136*(H-B),H=j+D,D=2.56291544774*(j-D),j=v+H,v=.541196100146*(v-H),H=y+p,p=1.30656296488*(y-p),y=j+H,H=.707106781187*(j-H),j=v+p,p=.707106781187*(v-p),j+=p,v=r+D,D=.541196100146*(r-D),r=J+B,B=1.30656296488*(J-B),J=v+r,r=.707106781187*(v-r),v=D+B,B=.707106781187*(D-B),v+=B,J+=v,v+=r,D=r+B,r=f+t,f=.509795579104*(f-t),t=h+x,h=.601344886935*(h-x),x=F+z,z=.899976223136*(F-z),F=l+n,n=2.56291544774*(l-n),l=r+F,r=.541196100146*(r-F),F=t+x,x=1.30656296488*(t-x),t=l+F,F=.707106781187*(l-F),l=r+x,x=.707106781187*(r-x),l+=x,r=f+n,f=.541196100146*(f-n),n=h+z,z=1.30656296488*(h-z),h=r+n,n=.707106781187*(r-n),r=f+z,f=.707106781187*(f-z),r+=f,h+=r,r+=n,n+=f,t+=h,h+=l,l+=r,r+=F,F+=n,n+=x,x+=f,y+=t,t+=J,J+=h,h+=j,j+=l,l+=v,v+=r,r+=H,H+=F,F+=D,D+=n,n+=p,p+=x,x+=B,B+=f,c[d+48]=-K,c[d+49]=c[d+47]=-y,c[d+50]=c[d+46]=-u,c[d+51]=c[d+45]=-t,c[d+52]=c[d+44]=-e,c[d+53]=c[d+43]=-J,c[d+54]=c[d+42]=-G,c[d+55]=c[d+41]=-h,c[d+56]=c[d+40]=-g,c[d+57]=c[d+39]=-j,c[d+58]=c[d+38]=-C,c[d+59]=c[d+37]=-l,c[d+60]=c[d+36]=-o,c[d+61]=c[d+35]=-v,c[d+62]=c[d+34]=-m,c[d+63]=c[d+33]=-r,c[d+32]=-i,c[d+0]=i,c[d+31]=-H,c[d+1]=H,c[d+30]=-E,c[d+2]=E,c[d+29]=-F,c[d+3]=F,c[d+28]=-k,c[d+4]=k,c[d+27]=-D,c[d+5]=D,c[d+26]=-A,c[d+6]=A,c[d+25]=-n,c[d+7]=n,c[d+24]=-s,c[d+8]=s,c[d+23]=-p,c[d+9]=p,c[d+22]=-w,c[d+10]=w,c[d+21]=-x,c[d+11]=x,c[d+20]=-q,c[d+12]=q,c[d+19]=-B,c[d+13]=B,c[d+18]=-I,c[d+14]=I,c[d+17]=-f,c[d+15]=f,c[d+16]=0},a.FRAME_SYNC=2047,a.VERSION={MPEG_2_5:0,MPEG_2:2,MPEG_1:3},a.LAYER={III:1,II:2,I:3},a.MODE={STEREO:0,JOINT_STEREO:1,DUAL_CHANNEL:2,MONO:3},a.SAMPLE_RATE=new Uint16Array([44100,48e3,32e3,0,22050,24e3,16e3,0]),a.BIT_RATE=new Uint16Array([32,48,56,64,80,96,112,128,160,192,224,256,320,384,8,16,24,32,40,48,56,64,80,96,112,128,144,160]),a.SCALEFACTOR_BASE=new Uint32Array([33554432,26632170,21137968]),a.SYNTHESIS_WINDOW=new Float32Array([0,-.5,-.5,-.5,-.5,-.5,-.5,-1,-1,-1,-1,-1.5,-1.5,-2,-2,-2.5,-2.5,-3,-3.5,-3.5,-4,-4.5,-5,-5.5,-6.5,-7,-8,-8.5,-9.5,-10.5,-12,-13,-14.5,-15.5,-17.5,-19,-20.5,-22.5,-24.5,-26.5,-29,-31.5,-34,-36.5,-39.5,-42.5,-45.5,-48.5,-52,-55.5,-58.5,-62.5,-66,-69.5,-73.5,-77,-80.5,-84.5,-88,-91.5,-95,-98,-101,-104,106.5,109,111,112.5,113.5,114,114,113.5,112,110.5,107.5,104,100,94.5,88.5,81.5,73,63.5,53,41.5,28.5,14.5,-1,-18,-36,-55.5,-76.5,-98.5,-122,-147,-173.5,-200.5,-229.5,-259.5,-290.5,-322.5,-355.5,-389.5,-424,-459.5,-495.5,-532,-568.5,-605,-641.5,-678,-714,-749,-783.5,-817,-849,-879.5,-908.5,-935,-959.5,-981,-1000.5,-1016,-1028.5,-1037.5,-1042.5,-1043.5,-1040,-1031.5,1018.5,1e3,976,946.5,911,869.5,822,767.5,707,640,565.5,485,397,302.5,201,92.5,-22.5,-144,-272.5,-407,-547.5,-694,-846,-1003,-1165,-1331.5,-1502,-1675.5,-1852.5,-2031.5,-2212.5,-2394,-2576.5,-2758.5,-2939.5,-3118.5,-3294.5,-3467.5,-3635.5,-3798.5,-3955,-4104.5,-4245.5,-4377.5,-4499,-4609.5,-4708,-4792.5,-4863.5,-4919,-4958,-4979.5,-4983,-4967.5,-4931.5,-4875,-4796,-4694.5,-4569.5,-4420,-4246,-4046,-3820,-3567,3287,2979.5,2644,2280.5,1888,1467.5,1018.5,541,35,-499,-1061,-1650,-2266.5,-2909,-3577,-4270,-4987.5,-5727.5,-6490,-7274,-8077.5,-8899.5,-9739,-10594.5,-11464.5,-12347,-13241,-14144.5,-15056,-15973.5,-16895.5,-17820,-18744.5,-19668,-20588,-21503,-22410.5,-23308.5,-24195,-25068.5,-25926.5,-26767,-27589,-28389,-29166.5,-29919,-30644.5,-31342,-32009.5,-32645,-33247,-33814.5,-34346,-34839.5,-35295,-35710,-36084.5,-36417.5,-36707.5,-36954,-37156.5,-37315,-37428,-37496,37519,37496,37428,37315,37156.5,36954,36707.5,36417.5,36084.5,35710,35295,34839.5,34346,33814.5,33247,32645,32009.5,31342,30644.5,29919,29166.5,28389,27589,26767,25926.5,25068.5,24195,23308.5,22410.5,21503,20588,19668,18744.5,17820,16895.5,15973.5,15056,14144.5,13241,12347,11464.5,10594.5,9739,8899.5,8077.5,7274,6490,5727.5,4987.5,4270,3577,2909,2266.5,1650,1061,499,-35,-541,-1018.5,-1467.5,-1888,-2280.5,-2644,-2979.5,3287,3567,3820,4046,4246,4420,4569.5,4694.5,4796,4875,4931.5,4967.5,4983,4979.5,4958,4919,4863.5,4792.5,4708,4609.5,4499,4377.5,4245.5,4104.5,3955,3798.5,3635.5,3467.5,3294.5,3118.5,2939.5,2758.5,2576.5,2394,2212.5,2031.5,1852.5,1675.5,1502,1331.5,1165,1003,846,694,547.5,407,272.5,144,22.5,-92.5,-201,-302.5,-397,-485,-565.5,-640,-707,-767.5,-822,-869.5,-911,-946.5,-976,-1e3,1018.5,1031.5,1040,1043.5,1042.5,1037.5,1028.5,1016,1000.5,981,959.5,935,908.5,879.5,849,817,783.5,749,714,678,641.5,605,568.5,532,495.5,459.5,424,389.5,355.5,322.5,290.5,259.5,229.5,200.5,173.5,147,122,98.5,76.5,55.5,36,18,1,-14.5,-28.5,-41.5,-53,-63.5,-73,-81.5,-88.5,-94.5,-100,-104,-107.5,-110.5,-112,-113.5,-114,-114,-113.5,-112.5,-111,-109,106.5,104,101,98,95,91.5,88,84.5,80.5,77,73.5,69.5,66,62.5,58.5,55.5,52,48.5,45.5,42.5,39.5,36.5,34,31.5,29,26.5,24.5,22.5,20.5,19,17.5,15.5,14.5,13,12,10.5,9.5,8.5,8,7,6.5,5.5,5,4.5,4,3.5,3.5,3,2.5,2.5,2,2,1.5,1.5,1,1,1,1,.5,.5,.5,.5,.5,.5]),a.QUANT_LUT_STEP_1=[[0,0,1,1,1,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,1,1,1,2,2,2,2,2]],a.QUANT_TAB={A:91,B:94,C:8,D:12},a.QUANT_LUT_STEP_2=[[a.QUANT_TAB.C,a.QUANT_TAB.C,a.QUANT_TAB.D],[a.QUANT_TAB.A,a.QUANT_TAB.A,a.QUANT_TAB.A],[a.QUANT_TAB.B,a.QUANT_TAB.A,a.QUANT_TAB.B]],a.QUANT_LUT_STEP_3=[[68,68,52,52,52,52,52,52,52,52,52,52],[67,67,67,66,66,66,66,66,66,66,66,49,49,49,49,49,49,49,49,49,49,49,49,32,32,32,32,32,32,32],[69,69,69,69,52,52,52,52,52,52,52,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36]],a.QUANT_LUT_STEP4=[[0,1,2,17],[0,1,2,3,4,5,6,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,17],[0,1,3,5,6,7,8,9,10,11,12,13,14,15,16,17],[0,1,2,4,5,6,7,8,9,10,11,12,13,14,15,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],a.QUANT_TAB=[{levels:3,group:1,bits:5},{levels:5,group:1,bits:7},{levels:7,group:0,bits:3},{levels:9,group:1,bits:10},{levels:15,group:0,bits:4},{levels:31,group:0,bits:5},{levels:63,group:0,bits:6},{levels:127,group:0,bits:7},{levels:255,group:0,bits:8},{levels:511,group:0,bits:9},{levels:1023,group:0,bits:10},{levels:2047,group:0,bits:11},{levels:4095,group:0,bits:12},{levels:8191,group:0,bits:13},{levels:16383,group:0,bits:14},{levels:32767,group:0,bits:15},{levels:65535,group:0,bits:16}],a}();
JSMpeg.Renderer.WebGL=function(){"use strict";var a=function(b){this.canvas=b.canvas||document.createElement("canvas"),this.width=this.canvas.width,this.height=this.canvas.height,this.enabled=!0,this.renderCallback=b.renderCallback||function(){};var c={preserveDrawingBuffer:!!b.preserveDrawingBuffer,alpha:!1,depth:!1,stencil:!1,antialias:!1};if(this.gl=this.canvas.getContext("webgl",c)||this.canvas.getContext("experimental-webgl",c),!this.gl)throw new Error("Failed to get WebGL Context");var d=this.gl,e=null;this.vertexBuffer=d.createBuffer();var f=new Float32Array([0,0,0,1,1,0,1,1]);d.bindBuffer(d.ARRAY_BUFFER,this.vertexBuffer),d.bufferData(d.ARRAY_BUFFER,f,d.STATIC_DRAW),this.program=this.createProgram(a.SHADER.VERTEX_IDENTITY,a.SHADER.FRAGMENT_YCRCB_TO_RGBA),e=d.getAttribLocation(this.program,"vertex"),d.enableVertexAttribArray(e),d.vertexAttribPointer(e,2,d.FLOAT,!1,0,0),this.textureY=this.createTexture(0,"textureY"),this.textureCb=this.createTexture(1,"textureCb"),this.textureCr=this.createTexture(2,"textureCr"),this.loadingProgram=this.createProgram(a.SHADER.VERTEX_IDENTITY,a.SHADER.FRAGMENT_LOADING),e=d.getAttribLocation(this.loadingProgram,"vertex"),d.enableVertexAttribArray(e),d.vertexAttribPointer(e,2,d.FLOAT,!1,0,0),this.shouldCreateUnclampedViews=!this.allowsClampedTextureData()};return a.prototype.destroy=function(){var a=this.gl;a.deleteTexture(this.textureY),a.deleteTexture(this.textureCb),a.deleteTexture(this.textureCr),a.deleteProgram(this.program),a.deleteProgram(this.loadingProgram),a.deleteBuffer(this.vertexBuffer)},a.prototype.resize=function(a,b){this.width=0|a,this.height=0|b,this.canvas.width=this.width,this.canvas.height=this.height,this.gl.useProgram(this.program),this.gl.viewport(0,0,this.width,this.height)},a.prototype.createTexture=function(a,b){var c=this.gl,d=c.createTexture();return c.bindTexture(c.TEXTURE_2D,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.uniform1i(c.getUniformLocation(this.program,b),a),d},a.prototype.createProgram=function(a,b){var c=this.gl,d=c.createProgram();return c.attachShader(d,this.compileShader(c.VERTEX_SHADER,a)),c.attachShader(d,this.compileShader(c.FRAGMENT_SHADER,b)),c.linkProgram(d),c.useProgram(d),d},a.prototype.compileShader=function(a,b){var c=this.gl,d=c.createShader(a);if(c.shaderSource(d,b),c.compileShader(d),!c.getShaderParameter(d,c.COMPILE_STATUS))throw new Error(c.getShaderInfoLog(d));return d},a.prototype.allowsClampedTextureData=function(){var a=this.gl,b=a.createTexture();return a.bindTexture(a.TEXTURE_2D,b),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,1,1,0,a.LUMINANCE,a.UNSIGNED_BYTE,new Uint8ClampedArray([0])),0===a.getError()},a.prototype.renderProgress=function(a){var b=this.gl;b.useProgram(this.loadingProgram);var c=b.getUniformLocation(this.loadingProgram,"progress");b.uniform1f(c,a),b.drawArrays(b.TRIANGLE_STRIP,0,4)},a.prototype.render=function(a,b,c){if(this.enabled){var d=this.gl,e=this.width+15>>4<<4,f=this.height,g=e>>1,h=f>>1;this.shouldCreateUnclampedViews&&(a=new Uint8Array(a.buffer),b=new Uint8Array(b.buffer),c=new Uint8Array(c.buffer)),d.useProgram(this.program),this.updateTexture(d.TEXTURE0,this.textureY,e,f,a),this.updateTexture(d.TEXTURE1,this.textureCb,g,h,b),this.updateTexture(d.TEXTURE2,this.textureCr,g,h,c),d.drawArrays(d.TRIANGLE_STRIP,0,4),"function"==typeof this.renderCallback&&this.renderCallback()}},a.prototype.updateTexture=function(a,b,c,d,e){var f=this.gl;f.activeTexture(a),f.bindTexture(f.TEXTURE_2D,b),f.texImage2D(f.TEXTURE_2D,0,f.LUMINANCE,c,d,0,f.LUMINANCE,f.UNSIGNED_BYTE,e)},a.IsSupported=function(){try{if(!window.WebGLRenderingContext)return!1;var a=document.createElement("canvas");return!(!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}},a.SHADER={FRAGMENT_YCRCB_TO_RGBA:["precision mediump float;","uniform sampler2D textureY;","uniform sampler2D textureCb;","uniform sampler2D textureCr;","varying vec2 texCoord;","mat4 rec601 = mat4(","1.16438,  0.00000,  1.59603, -0.87079,","1.16438, -0.39176, -0.81297,  0.52959,","1.16438,  2.01723,  0.00000, -1.08139,","0, 0, 0, 1",");","void main() {","float y = texture2D(textureY, texCoord).r;","float cb = texture2D(textureCb, texCoord).r;","float cr = texture2D(textureCr, texCoord).r;","gl_FragColor = vec4(y, cr, cb, 1.0) * rec601;","}"].join("\n"),FRAGMENT_LOADING:["precision mediump float;","uniform float progress;","varying vec2 texCoord;","void main() {","float c = ceil(progress-(1.0-texCoord.y));","gl_FragColor = vec4(c,c,c,1);","}"].join("\n"),VERTEX_IDENTITY:["attribute vec2 vertex;","varying vec2 texCoord;","void main() {","texCoord = vertex;","gl_Position = vec4((vertex * 2.0 - 1.0) * vec2(1, -1), 0.0, 1.0);","}"].join("\n")},a}();
JSMpeg.Renderer.Canvas2D=function(){"use strict";var a=function(a){this.canvas=a.canvas||document.createElement("canvas"),this.width=this.canvas.width,this.height=this.canvas.height,this.enabled=!0,this.renderCallback=a.renderCallback||function(){},this.context=this.canvas.getContext("2d")};return a.prototype.destroy=function(){},a.prototype.resize=function(a,b){this.width=0|a,this.height=0|b,this.canvas.width=this.width,this.canvas.height=this.height,this.imageData=this.context.getImageData(0,0,this.width,this.height),JSMpeg.Fill(this.imageData.data,255)},a.prototype.renderProgress=function(a){var b=this.canvas.width,c=this.canvas.height,d=this.context;d.fillStyle="#222",d.fillRect(0,0,b,c),d.fillStyle="#fff",d.fillRect(0,c-c*a,b,c*a)},a.prototype.render=function(a,b,c){this.YCbCrToRGBA(a,b,c,this.imageData.data),this.context.putImageData(this.imageData,0,0),"function"==typeof this.renderCallback&&this.renderCallback()},a.prototype.YCbCrToRGBA=function(a,b,c,d){if(this.enabled)for(var e,f,g,h,i,j=this.width+15>>4<<4,k=j>>1,l=0,m=j,n=j+(j-this.width),o=0,p=k-(this.width>>1),q=0,r=4*this.width,s=4*this.width,t=this.width>>1,u=this.height>>1,v=0;u>v;v++){for(var w=0;t>w;w++){e=b[o],f=c[o],o++,g=e+(103*e>>8)-179,h=(88*f>>8)-44+(183*e>>8)-91,i=f+(198*f>>8)-227;var x=a[l++],y=a[l++];d[q]=x+g,d[q+1]=x-h,d[q+2]=x+i,d[q+4]=y+g,d[q+5]=y-h,d[q+6]=y+i,q+=8;var z=a[m++],A=a[m++];d[r]=z+g,d[r+1]=z-h,d[r+2]=z+i,d[r+4]=A+g,d[r+5]=A-h,d[r+6]=A+i,r+=8}l+=n,m+=n,q+=s,r+=s,o+=p}},a}();
JSMpeg.AudioOutput.WebAudio=function(){"use strict";var a=function(b){this.context=a.CachedContext=a.CachedContext||new(window.AudioContext||window.webkitAudioContext),this.gain=this.context.createGain(),this.destination=this.gain,this.source=null,this.gain.connect(this.context.destination),this.context._connections=(this.context._connections||0)+1,this.startTime=0,this.buffer=null,this.wallclockStartTime=0,this.volume=1,this.enabled=!0,this.unlocked=!a.NeedsUnlocking(),Object.defineProperty(this,"enqueuedTime",{get:this.getEnqueuedTime})};return a.prototype.destroy=function(){this.gain.disconnect(),this.context._connections--,0===this.context._connections&&(this.context.close(),a.CachedContext=null)},a.prototype.play=function(a,b,c){if(this.enabled){if(!this.unlocked){var d=JSMpeg.Now();return this.wallclockStartTime<d&&(this.wallclockStartTime=d),void(this.wallclockStartTime+=b.length/a)}this.gain.gain.value=this.volume;var e=this.context.createBuffer(2,b.length,a);e.getChannelData(0).set(b),e.getChannelData(1).set(c),this.source=this.context.createBufferSource(),this.source.buffer=e,this.source.connect(this.destination);var f=this.context.currentTime,g=e.duration;this.startTime<f&&(this.startTime=f,this.wallclockStartTime=JSMpeg.Now()),this.source.start(this.startTime),this.startTime+=g,this.wallclockStartTime+=g}},a.prototype.stop=function(){this.gain.gain.value=0},a.prototype.getEnqueuedTime=function(){return Math.max(this.wallclockStartTime-JSMpeg.Now(),0)},a.prototype.resetEnqueuedTime=function(){this.startTime=this.context.currentTime,this.wallclockStartTime=JSMpeg.Now()},a.prototype.unlock=function(a){if(this.unlocked)return void(a&&a());this.unlockCallback=a;var b=this.context.createBuffer(1,1,22050);this.source=this.context.createBufferSource(),this.source.buffer=b,this.source.connect(this.destination),this.source.start(0),setTimeout(this.checkIfUnlocked.bind(this,source,0),0)},a.prototype.checkIfUnlocked=function(a,b){a.playbackState===a.PLAYING_STATE||a.playbackState===a.FINISHED_STATE?(this.unlocked=!0,this.unlockCallback&&(this.unlockCallback(),this.unlockCallback=null)):10>b&&setTimeout(this.checkIfUnlocked.bind(this,a,b+1),100)},a.NeedsUnlocking=function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},a.IsSupported=function(){return window.AudioContext||window.webkitAudioContext},a.CachedContext=null,a}();